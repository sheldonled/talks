<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Google Drive API â€“ Sheldon Led</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <link rel="stylesheet" href="../tools/reveal.js/css/reveal.css">
  <link rel="stylesheet" href="../tools/reveal.js/css/theme/white-google.css" id="theme">
  <link rel="stylesheet" href="../src/css/gdrive.css" id="theme">

  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match(/print-pdf/gi) ? '../tools/reveal.js/css/print/pdf.css' : '../tools/reveal.js/css/print/paper.css';
    document.getElementsByTagName('head')[0].appendChild(link);
  </script>

  <!--[if lt IE 9]>
        <script src="tools/reveal.js/lib/js/html5shiv.js"></script>
        <![endif]-->
</head>

<body>
  <div class="reveal">
    <div class="slides">
      <section>
        <img src="../img/google_drive.png" alt="Google Drive">
        <h1>API</h1>
        <h5>An introduction to Google Drive API and how to integrate it with your application</h5>
        <p>
          <a href="http://www.sheldonled.com" target="_blank">Sheldon Led</a>
        </p>
      </section>

      <section>
        <h2>Agenda</h2>
        <ul>
          <li>Why I needed to use it (1min)</li>
          <li>Drive API Overview (2min)</li>
          <li>Code Sample (2min)</li>
        </ul>
      </section>
      <section>
        <section>
          <h2>The need</h2>
          <ul>
            <li class="fragment">Large scale print</li>
            <li class="fragment">How to send hundres of files daily to the print shop?</li>
          </ul>
        </section>
        <section>
          <ul>
            <li class="fragment">E-mail attachment? Not quite feasible.</li>
            <li class="fragment">In-house solution to upload/download these files?</li>
            <li class="fragment">WebService / API</li>
          </ul>
        </section>
        <section>
          <h2>Cloud storage service</h2>
        </section>
      </section>
      <section>
        <section data-background="http://i.giphy.com/90F8aUepslB84.gif">
          <img src="../img/google_drive.png" alt="Google Drive" style="width: 500px;margin-top: 30%;">
        </section>
        <section>
          <h2>Easy Integration</h2>
          <ul>
            <li class="fragment">HTTP</li>
            <li class="fragment">Client libraries in several programming languages</li>
            <li class="fragment">
              Your app in the context menu
              <strong style="background-color:rgba(0, 102, 204, 0.3);border-radius: 50%;padding: 1px 10px;transform: rotate(45deg);display: inline-block;">
                <span class="green">:</span>
                <span class="yellow">)</span>
              </strong>
            </li>
          </ul>
        </section>
        <section>
          <h2>Client Libraries</h2>
          <ul>
            <li>.NET</li>
            <li>Android</li>
            <li>Go</li>
            <li>iOS</li>
            <li>Java</li>
            <li>JavaScript</li>
            <li>Node.js</li>
            <li>PHP</li>
            <li>Python</li>
            <li>Ruby</li>
          </ul>
        </section>
      </section>
      <section>
        <section>
          <h2>Getting Started</h2>
          <ul>
            <li class="fragment">Go to the
              <a href="https://console.developers.google.com" target="_blank">Google Developers Console</a>.</li>
            <li class="fragment">
              <a href="https://console.developers.google.com/start/api?id=drive" target="_blank">Create a project</a> and set the credentials</li>
            <li class="fragment">Go to the
              <a href="https://developers.google.com/drive/" target="_blank">Google Developers Portal</a>, check the
              <a href="https://developers.google.com/drive/" target="_blank">Google Drive APIs</a>
            </li>
            <li class="fragment">
              <a href="https://developers.google.com/drive/v3/web/about-sdk" target="_blank">Chose your SDK</a> and download it.</li>
            <li class="fragment">Do the sample code, and check
              <a href="https://github.com/googledrive" target="_blank">Google Drive on Github</a>
            </li>
            <li class="fragment">Also, check my sample of
              <em>Upload, Download, List and Delete</em> files using
              <span class="green">PHP</span> SDK. It's called
              <a href="https://github.com/sheldonled/easygd" target="_blank" style="background-color: #A7A7A7; padding: 0 5px">
                <span class="green">Easy</span>
                <span class="yellow">GD</span>
              </a> and it's also available on
              <a href="https://github.com/sheldonled/easygd" target="_blank">Github</a>.
          </ul>
        </section>
        <section>
          <!-- styles for live demo -->
          <style>
            #content {
              min-height: 50vh;
            }
          </style>
          <h2>Live Demo</h2>
          <p>
            Uploading files to
            <a href="https://drive.google.com/drive/folders/1LYS8YFGIYVh4H1JXUgUghgxkljzUnKld" target="_blank">public folder on Google Drive</a>
          </p>
          <!-- Add buttons to initiate auth sequence and sign out -->
          <button id="authorize-button" style="display: none;">Authorize</button>
          <button id="signout-button" style="display: none;">Sign Out</button>
        
          <!-- Form to upload files -->
          <form id="upload-form" style="display: none;">
            <p>Upload from the computer</p>
            <input id="upload-file" type="file">
            <p>Upload from url:</p>
            <input id="upload-text" type="text">
            <button id="upload-button" type="button">Upload</button>
          </form>
        
          <!-- Content div to show list of files -->
          <div id="content"></div>
        
          <script type="text/javascript">
            class QuickStart {
              constructor() {
                // Client ID and API key from the Developer Console
                this.CLIENT_ID = '876770809142-79puqm6ukd5ilipcthvsq3caekss0gqe.apps.googleusercontent.com';
                this.API_KEY = 'AIzaSyDlqgz4EKBA7mqxlHGB8Rbo7sIk40BOksA';
                // Authorization scopes required by the API
                this.SCOPES = 'https://www.googleapis.com/auth/drive.file';
        
                //The folder to work with
                this.FOLDER_ID = '1LYS8YFGIYVh4H1JXUgUghgxkljzUnKld';
        
                //sign-in state buttons
                this.authorizeButton = document.querySelector('#authorize-button');
                this.signoutButton = document.querySelector('#signout-button');
                this.uploadForm = document.querySelector('#upload-form');
                this.uploadInputFile = document.querySelector('#upload-file');
                this.uploadInputText = document.querySelector('#upload-text');
                this.uploadButton = document.querySelector('#upload-button');
                this.contentContainer = document.querySelector('#content');
              };
        
              /**
               *  On load, called to load the auth2 library and API client library.
               */
              handleClientLoad() {
                gapi.load('client:auth2', () => gapi.client.load('drive', 'v3', this.initClient.bind(this)));
              };
        
              /**
               *  Initializes the API client library and sets up sign-in state listeners.
               */
              initClient() {
                gapi.client.init({
                  apiKey: this.API_KEY,
                  clientId: this.CLIENT_ID,
                  scope: this.SCOPES,
                }).then(() => {
                  // Listen for sign-in state changes.
                  gapi.auth2.getAuthInstance().isSignedIn.listen(this.updateSigninStatus);
                  this.setSignInListeners();
                  // Handle the initial sign-in state.
                  this.updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
                });
              };
        
              //Sets up sign-in state listeners.
              setSignInListeners() {
                document.addEventListener('click', evt => {
                  if (evt.target.id === this.authorizeButton.id)
                    gapi.auth2.getAuthInstance().signIn();
        
                  if (evt.target.id === this.signoutButton.id)
                    gapi.auth2.getAuthInstance().signOut();
        
                  if (evt.target.id === this.uploadButton.id)
                    this.uploadFile();
        
                });
              };
        
              /**
               *  Called when the signed in status changes, to update the UI
               *  appropriately. After a sign-in, the API is called.
               */
              updateSigninStatus(isSignedIn) {
                this.authorizeButton.style.display = isSignedIn ? 'none' : 'block';
                this.signoutButton.style.display = isSignedIn ? 'block' : 'none';
                this.uploadForm.style.display = isSignedIn ? 'block' : 'none';
        
                if (!isSignedIn) return;
                this.getAllFiles();
              };
        
              /**
               * Gets all files from the folder ID
               */
              getAllFiles(request, result) {
                const query = `'${this.FOLDER_ID}' in parents and (trashed != true)`;
        
                if (!request) {
                  this.getAllFiles(gapi.client.request({
                    'path': '/drive/v3/files',
                    'method': 'GET',
                    'params': { q: query },
                  }), []);
                  return;
                }
        
                request.execute(resp => {
                  result = result.concat(resp.files);
                  let nextPageToken = resp.nextPageToken;
                  if (!nextPageToken) {
                    this.renderFileList(result);
                    return;
                  }
        
                  this.getAllFiles(gapi.client.request({
                    'path': '/drive/v3/files',
                    'method': 'GET',
                    'params': { q: query },
                  }), result);
                });
              };
        
              renderFileList(files) {
                if (files.length === 0) {
                  this.contentContainer.innerHTML = "<p><strong>The folder is Empty</strong></p>";
                  return;
                }
        
                const content = files.reduce((list, file) => list += `<li> ${file.name} </li>`, '<ul>');
        
                this.contentContainer.innerHTML = `${content}</ul>`;
        
              };
        
              uploadFile() {
                if (this.uploadInputFile.files[0])
                  this.uploadFromComputer();
                else
                  this.uploadFromUrl();
        
                this.uploadForm.reset();
              };
        
              uploadFromComputer() {
                const file = this.uploadInputFile.files[0];
                this.readFileAndSendToGoogleDrive(file, file);
              };
        
              uploadFromUrl() {
                const url = this.uploadInputText.value,
                      urlParts = url.split("/"),
                      fileInfo = {
                        name: decodeURIComponent(urlParts[urlParts.length-1])
                      };
        
                fetch(url).then(response => {
                  if(response.ok) return response.blob();
                  throw new Error('Network response was not ok.');
                }).then(myBlob => {
                  fileInfo.type = myBlob.type;
                  this.readFileAndSendToGoogleDrive(myBlob, fileInfo);
                });
              };
        
              readFileAndSendToGoogleDrive(file, fileInfo) {
                  const filereader = new FileReader();
                  filereader.onloadend = event => this.sendFileToGoogleDrive(event, fileInfo);
                  filereader.readAsBinaryString(file);
              }
        
              sendFileToGoogleDrive(event, file) {
                const base64Data = btoa(event.target.result),
                      boundary = '-whatever-you-want-',
                      fileMetadata = {
                        'name': file.name,
                        'mimeType': file.type,
                        'parents': [this.FOLDER_ID]
                      };
        
                gapi.client.request({
                  'path': '/upload/drive/v3/files',
                  'method': 'POST',
                  'params': { 'uploadType': 'multipart' },
                  'headers': {
                    'Content-Type': 'multipart/related; boundary="' + boundary + '"'
                  },
                  'body': `--${boundary}
                        Content-Type: application/json
                        
                        ${JSON.stringify(fileMetadata)}
                        --${boundary}
                        Content-Type: ${fileMetadata.mimeType}
                        Content-Transfer-Encoding: base64
                        
                        ${base64Data}
                        --${boundary}--
                    `.replace(/((?![\r\n])\s){2,}/g, ""),//Removing spaces
                })
                  .execute(file => this.getAllFiles());
              };
        
            };
            const quickstart = new QuickStart();
          </script>
        
          <script async defer src="https://apis.google.com/js/api.js" onload="this.onload=function(){};quickstart.handleClientLoad()"
            onreadystatechange="if (this.readyState === 'complete') this.onload()">
            </script>
        </section>
      </section>
      <section>
        <h1>THANKS</h1>
        <p>
          <a href="http://www.sheldonled.com" target="_blank">www.sheldonled.com</a>
        </p>
        <div class="social">
          <a target="_blank" href="https://github.com/sheldonled" class="social__link">
            <svg class="icon__github">
              <use xlink:href="../img/symbol-defs.svg#icon-github"></use>
            </svg>
          </a>
          <a target="_blank" href="https://twitter.com/sheldonled" class="social__link">
            <svg class="icon__twitter">
              <use xlink:href="../img/symbol-defs.svg#icon-twitter"></use>
            </svg>
          </a>
          <a target="_blank" href="https://linkedin.com/in/sheldonled" class="social__link">
            <svg class="icon__linkedin">
              <use xlink:href="../img/symbol-defs.svg#icon-linkedin"></use>
            </svg>
          </a>
          <a target="_blank" href="https://instagram.com/sheldonled" class="social__link">
            <svg class="icon__instagram">
              <use xlink:href="../img/symbol-defs.svg#icon-instagram"></use>
            </svg>
          </a>
          <a target="_blank" href="https://facebook.com/sheldonled" class="social__link">
            <svg class="icon__facebook">
              <use xlink:href="../img/symbol-defs.svg#icon-facebook"></use>
            </svg>
          </a>
        </div>
    </div>
  </div>
  <script src="../tools/reveal.js/lib/js/head.min.js"></script>
  <script src="../tools/reveal.js/js/reveal.js"></script>
  <script>
    Reveal.initialize({
      controls: true,
      progress: true,
      history: true,
      center: true,

      transition: 'slide', // none/fade/slide/convex/concave/zoom
      dependencies: [
        { src: '../tools/reveal.js/plugin/notes/notes.js', async: true }
      ]
    });
  </script>
</body>

</html>